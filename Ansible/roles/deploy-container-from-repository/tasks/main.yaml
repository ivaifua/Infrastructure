---
  - name: Log into private registry and force re-authorization
    docker_login:
      registry: eu.gcr.io
      username: _json_key	
      debug: true
      password: " {{ lookup('file', '/var/lib/jenkins/workspace/Terraform/credentials.json')}}" 
    
  - name: Create carts container
    docker_container:
      name: carts
      state: present
      image: eu.gcr.io/silicon-dialect-245108/carts:latest
      exposed_ports:
       - 8081
      networks:
       - name: microservicesnetwork
    register: register_carts_created  
    
  - name: Start container
    docker_container:
     name: mycontainer
     state: started

  - name: Purge networks
    docker_container:
     name: carts
     networks: 
          -name: microservicesnetwork
     purge_networks: yes
     state: started
     when: register_carts_created|changed  

  
